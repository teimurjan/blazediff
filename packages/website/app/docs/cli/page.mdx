# @blazediff/cli

import { Callout, Tabs } from 'nextra/components'

Command-line tool for high-performance image comparison. Supports multiple algorithms including the native Rust binary (fastest), JavaScript pixel diff, GMSD, SSIM, MS-SSIM, and Hitchhiker's SSIM.

[View Detailed Benchmarks](https://github.com/teimurjan/blazediff/blob/main/BENCHMARKS.md)

## Installation

### Global Installation

```sh npm2yarn
npm install -g @blazediff/cli
```

### Local Installation

```sh npm2yarn
npm install --save-dev @blazediff/cli
```

### Using npx

```sh npm2yarn
npx blazediff-cli image1.png image2.png diff.png
```

## Features

- **Native Binary**: Rust + SIMD for maximum performance (3-4x faster than odiff)
- **Multiple Algorithms**: Pixel diff, GMSD, SSIM, MS-SSIM, Hitchhiker's SSIM
- **Multiple Formats**: PNG, JPEG, WebP support
- **High Performance**: Optimized implementations for all algorithms
- **Flexible Output**: Save diff/similarity maps or get exit codes
- **CI/CD Ready**: Perfect for automated visual testing
- **Cross-Platform**: Works on Windows, macOS, and Linux

## Available Commands

<Tabs items={['bin (default)', 'core', 'gmsd', 'ssim', 'msssim', 'hitchhikers-ssim']}>
  <Tabs.Tab>

### `blazediff-cli bin` (default)

Native Rust binary with SIMD optimization. The fastest option - **3-4x faster** than odiff on large images.

#### Basic Usage

```bash
# Default command (bin)
blazediff-cli image1.png image2.png diff.png

# Or explicitly
blazediff-cli bin image1.png image2.png diff.png
```

#### With Options

```bash
blazediff-cli image1.png image2.png diff.png --threshold 0.05 --antialiasing
```

#### Options

```bash
blazediff-cli bin <image1> <image2> <output> [options]

Options:
  -t, --threshold <n>      Color difference threshold (0-1, default: 0.1)
  -a, --antialiasing       Enable anti-aliasing detection
  --diff-mask              Output only differences (transparent background)
  --fail-on-layout         Fail immediately if images have different dimensions
  -c, --compression <n>    PNG compression level (0-9, default: 0)
  -h, --help               Display help
```

#### Exit Codes

- `0` - Images are identical
- `1` - Images have differences
- `2` - Error (file not found, invalid format, etc.)

```bash
blazediff-cli image1.png image2.png diff.png
if [ $? -eq 0 ]; then
  echo "Images match!"
else
  echo "Images differ!"
fi
```

<Callout type="info">
  **Why so fast?** Uses a two-pass block-based algorithm with SIMD acceleration (NEON on ARM, SSE4.1 on x86). The cold pass quickly identifies unchanged blocks, then the hot pass only processes changed regions.
</Callout>

  </Tabs.Tab>

  <Tabs.Tab>

### `blazediff-cli core`

Pure JavaScript pixel-by-pixel comparison. Slower than `bin` but offers more customization options like custom diff colors and color spaces.

#### Basic Usage

```bash
blazediff-cli core image1.png image2.png
```

#### Save Diff Image

```bash
blazediff-cli core image1.png image2.png --output diff.png
```

#### Options

```bash
blazediff-cli core <image1> <image2> [options]

Options:
  -o, --output <path>      Output diff image path
  -t, --threshold <n>      Matching threshold (0-1, default: 0.1)
  -a, --alpha <n>          Opacity of original in diff (0-1, default: 0.1)
  --diff-color <r,g,b>     Color for different pixels (default: 255,0,0)
  --aa-color <r,g,b>       Color for anti-aliased pixels (default: 255,255,0)
  --include-aa             Include anti-aliased pixels in diff count
  --diff-mask              Output diff mask with transparent background
  --color-space <name>     Color space to use (yiq, ycbcr)
  --transformer <name>     Image transformer (pngjs, sharp)
  -h, --help               Display help
```

#### Exit Codes

- `0` - Images are identical or within threshold
- `1` - Images have differences beyond threshold

```bash
blazediff-cli core image1.png image2.png
if [ $? -eq 0 ]; then
  echo "Images match!"
else
  echo "Images differ!"
fi
```

  </Tabs.Tab>

  <Tabs.Tab>

### `blazediff-cli gmsd`

GMSD (Gradient Magnitude Similarity Deviation) perceptual quality assessment. Returns a similarity score from 0-1.

#### Basic Usage

```bash
blazediff-cli gmsd image1.png image2.png
```

#### Save GMS Map

```bash
blazediff-cli gmsd image1.png image2.png --output gms-map.png
```

#### Options

```bash
blazediff-cli gmsd <image1> <image2> [options]

Options:
  -o, --output <path>      Output GMS map image path
  --downsample <n>         Downsample factor (0 or 1, default: 0)
  -h, --help              Display help
```

#### Output

Prints the GMSD score (lower = more similar):
- `0.0` - Images are identical
- `0.0-0.05` - Very low difference
- `0.05-0.15` - Low difference
- `0.15-0.35` - Moderate difference
- `>0.35` - High difference

#### Example

```bash
$ blazediff-cli gmsd reference.png test.png
GMSD: 0.0234

$ blazediff-cli gmsd reference.png test.png --output gms-map.png
GMSD: 0.0234
GMS map saved to: gms-map.png
```

  </Tabs.Tab>

  <Tabs.Tab>

### `blazediff-cli ssim`

Standard SSIM (Structural Similarity Index) with Gaussian weighting. MATLAB-compatible with \<0.01% error.

#### Basic Usage

```bash
blazediff-cli ssim image1.png image2.png
```

#### Save SSIM Map

```bash
blazediff-cli ssim image1.png image2.png --output ssim-map.png
```

#### Options

```bash
blazediff-cli ssim <image1> <image2> [options]

Options:
  -o, --output <path>      Output SSIM map image path
  --window-size <n>        Gaussian window size (default: 11)
  --k1 <n>                 Algorithm parameter (default: 0.01)
  --k2 <n>                 Algorithm parameter (default: 0.03)
  -h, --help              Display help
```

#### Output

Prints the SSIM score (higher = more similar):
- `1.0` - Identical images
- `0.99+` - Excellent similarity
- `0.95-0.99` - Very good similarity
- `0.90-0.95` - Good similarity
- `0.80-0.90` - Fair similarity
- `<0.80` - Poor similarity

#### Example

```bash
$ blazediff-cli ssim reference.png test.png
SSIM: 0.9876

$ blazediff-cli ssim reference.png test.png --output ssim-map.png --window-size 8
SSIM: 0.9823
SSIM map saved to: ssim-map.png
```

  </Tabs.Tab>

  <Tabs.Tab>

### `blazediff-cli msssim`

MS-SSIM (Multi-Scale SSIM) for better perceptual correlation. Analyzes images at multiple scales.

#### Basic Usage

```bash
blazediff-cli msssim image1.png image2.png
```

#### Save MS-SSIM Map

```bash
blazediff-cli msssim image1.png image2.png --output msssim-map.png
```

#### Options

```bash
blazediff-cli msssim <image1> <image2> [options]

Options:
  -o, --output <path>      Output SSIM map at finest scale
  --window-size <n>        Gaussian window size (default: 11)
  --scales <n>             Number of scales (default: 5)
  --method <type>          Aggregation method: product or sum (default: product)
  -h, --help              Display help
```

#### Output

Prints the MS-SSIM score (higher = more similar):
- `1.0` - Identical images
- `0.99+` - Excellent similarity
- `0.95-0.99` - Very good similarity
- `0.90-0.95` - Good similarity
- `0.80-0.90` - Fair similarity
- `<0.80` - Poor similarity

#### Example

```bash
$ blazediff-cli msssim reference.png test.png
MS-SSIM: 0.9912

$ blazediff-cli msssim reference.png test.png --scales 3 --method sum
MS-SSIM: 0.9876
```

  </Tabs.Tab>

  <Tabs.Tab>

### `blazediff-cli hitchhikers-ssim`

Hitchhiker's SSIM - fast rectangular-window SSIM using integral images. ~4x faster than standard SSIM.

#### Basic Usage

```bash
blazediff-cli hitchhikers-ssim image1.png image2.png
```

#### Save SSIM Map

```bash
blazediff-cli hitchhikers-ssim image1.png image2.png --output ssim-map.png
```

#### Options

```bash
blazediff-cli hitchhikers-ssim <image1> <image2> [options]

Options:
  -o, --output <path>      Output SSIM map image path
  --window-size <n>        Rectangular window size (default: 11)
  --window-stride <n>      Window stride (default: window-size)
  --no-cov-pooling         Disable CoV pooling (use mean pooling)
  --k1 <n>                 Algorithm parameter (default: 0.01)
  --k2 <n>                 Algorithm parameter (default: 0.03)
  -h, --help              Display help
```

#### Output

Prints the SSIM score (higher = more similar):
- `1.0` - Identical images
- `0.99+` - Excellent similarity
- `0.95-0.99` - Very good similarity
- `0.90-0.95` - Good similarity
- `0.80-0.90` - Fair similarity
- `<0.80` - Poor similarity

#### Example

```bash
$ blazediff-cli hitchhikers-ssim reference.png test.png
SSIM: 0.9597

$ blazediff-cli hitchhikers-ssim reference.png test.png --window-size 16 --window-stride 8
SSIM: 0.9612
SSIM map saved to: ssim-map.png
```

<Callout type="info">
  **CoV Pooling**: Coefficient of Variation pooling is enabled by default and provides better perceptual correlation than mean pooling. Use `--no-cov-pooling` to disable.
</Callout>

  </Tabs.Tab>
</Tabs>

## When to Use Each Algorithm

**Use `bin` (default) when:**
- You need maximum performance
- You're running in CI/CD pipelines
- You're comparing large images (4K+)
- You want the smallest binary footprint

**Use `core` when:**
- You need custom diff colors
- You want to customize the color space
- You need fine-grained control over output appearance
- You're already using pngjs/sharp in your pipeline

**Use `gmsd` when:**
- You need a similarity score for CI/CD
- You're comparing images with compression artifacts
- You want gradient-based perceptual quality
- You need fast single-threaded computation

**Use `ssim` when:**
- You need MATLAB-compatible results
- You want high accuracy with Gaussian weighting
- You need automatic downsampling for large images
- Research or comparison requires standard SSIM

**Use `msssim` when:**
- You need multi-scale analysis
- You're working with images at different resolutions
- You want better correlation with human perception
- You can afford ~2-3x computation cost vs SSIM

**Use `hitchhikers-ssim` when:**
- You need maximum performance (~4x faster than SSIM)
- You're processing large images or many images
- You want O(1) window computation
- You need flexible window stride for overlapping/non-overlapping windows

## Links

- [GitHub Repository](https://github.com/teimurjan/blazediff)
- [NPM Package](https://www.npmjs.com/package/@blazediff/cli)
- [Examples â†’](/examples/image-comparison)
